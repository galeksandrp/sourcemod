addons:
  apt:
    packages:
    - lib32gcc1
    - lib32stdc++6
install:
- mkdir -p ~/steamcmd
- cd ~/steamcmd
- wget https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz -O - | tar xz
- ./steamcmd.sh +login anonymous +force_install_dir ~/css +app_update 232330 +quit
script:
- mkdir -p ~/css/cstrike/addons
- cd ~/css/cstrike/addons
- ln -s sourcemod $TRAVIS_BUILD_DIR
- cd $TRAVIS_BUILD_DIR
- |
  wget $(echo 'http://www.gsptalk.com/mirror/sourcemod/mmsource-1.10.6-linux.tar.gz
  http://mirror.pointysoftware.net/alliedmodders/mmsource-1.10.6-linux.tar.gz
  http://cdn.probablyaserver.com/sourcemod/mmsource-1.10.6-linux.tar.gz' | sort -R | head -1) -O - | tar xz -C ~/css/cstrike
- git fetch --unshallow origin
- git remote add upstream https://github.com/alliedmodders/sourcemod.git
- git fetch upstream master
- wget $(echo "https://sm.alliedmods.net/smdrop/$(cat product.version | grep -o '[0-9]*\.[0-9]*' | head -1)/sourcemod-$(cat product.version)-git$(git log --oneline $(git merge-base upstream/master $TRAVIS_COMMIT) | wc -l)-linux.tar.gz") -O - | tar xz -C ~/css/cstrike
- cd ~/css
- cstrike/addons/sourcemod/scripting/spcomp $TRAVIS_BUILD_DIR/plugins/test.sp -ocstrike/addons/sourcemod/plugins/test.smx
- ./srcds_run -console -game cstrike +map de_dust2
notifications:
  email: false
